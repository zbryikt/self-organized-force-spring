$(document).ready(function(){var t,e,r,n,a,c,l,o,u;for(e=[],r=0;100>r;++r)n=r,e.push({idx:n,x:600*Math.random()+100,y:400*Math.random()+100,r:8*Math.random()+2});for(t=e,e=[],r=0;99>r;++r)n=r,e.push({idx:n});return a=e,c=d3.scale.linear().domain([2,6,10]).range(["#090","#ff0","#f00"]),l=function(){return d3.select("svg").selectAll("path").data(a).enter().append("path").each(function(t){return t.node=this}),d3.select("svg").selectAll("circle").data(t).enter().append("circle")},o=function(){var e,r,n,l,o,d,i,s,f,h;for(spline.update(t,a),e=u.alpha(),r=0,n=a.length;n>r;++r)l=r,o=t[l].x-t[l+1].x,d=t[l].y-t[l+1].y,i=(t[l].r+t[l+1].r)/2,s=a[l].node.getTotalLength(),f=20,s>30&&(s=30),10>s&&(s=10),Math.abs(s-f)>5&&(s=i*e*(s-f)/s*.5,h=[o*s,d*s],o=h[0],d=h[1],t[l].x-=o,t[l].y-=d,t[l+1].x+=o,t[l+1].y+=d);return d3.select("svg").selectAll("circle").attr({cx:function(t){return t.x},cy:function(t){return t.y},r:function(t){return t.r},fill:function(t){return c(t.r)},stroke:"#444"}),d3.select("svg").selectAll("path").attr({d:function(t){return t.d},fill:"none",stroke:"#444"})},l(),u=d3.layout.force().size([800,600]).charge(function(t){return t.r*t.r*-2}),u.nodes(t).on("tick",o).start()});